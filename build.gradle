/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Scala library project to get you started.
 * For more details take a look at the Scala plugin chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.6/userguide/scala_plugin.html
 */

plugins {
    // Apply the scala plugin to add support for Scala
    id 'scala'
    id 'java'
    id 'idea'
    id 'maven-publish'
    id "com.jfrog.bintray" version "1.8.4"
}

repositories {
    google()
    jcenter()
}

ext {
    sparkVersion = "2.4.3"
    scalaMajorVersion = "2.11"
    scalaVersion = "$scalaMajorVersion.12"
}

dependencies {
    compile("com.github.scopt:scopt_$scalaMajorVersion:3.7.1")

    compileOnly("org.apache.spark:spark-core_$scalaMajorVersion:$sparkVersion")
    compileOnly("org.scala-lang:scala-library:$scalaVersion")
    compileOnly("org.apache.spark:spark-sql_$scalaMajorVersion:$sparkVersion")
    compileOnly("org.apache.spark:spark-hive_$scalaMajorVersion:$sparkVersion")

    // Use Scalatest for testing our library
    testImplementation("junit:junit:4.+")
    testImplementation("org.scalatest:scalatest_$scalaMajorVersion:3.0.7")
    testImplementation("org.apache.spark:spark-core_$scalaMajorVersion:$sparkVersion")

    // Need scala-xml at test runtime
    testRuntimeOnly("org.scala-lang.modules:scala-xml_$scalaMajorVersion:1.2.0")
}

group = 'com.viewtreefull.utils'
version = '0.1.0'

allprojects {
    tasks.register("projectInfo") {
        description = "Print project information"
        doLast {
            println("groupId: ${project.group}")
            println("artifactId: ${project.name}")
            println("version: ${project.version}")
        }

    }
}

bintray {
    user = project.hasProperty('bintrayUser') ? project.property('bintrayUser') : System.getenv('BINTRAY_USER')
    key = project.hasProperty('bintrayKey') ? project.property('bintrayKey') : System.getenv('BINTRAY_KEY')
    publications = ['MyPublication']
    publish = true
    pkg {
        repo = 'cobweb'
        name = "${project.name}"
        licenses = ['Apache-2.0']
        vcsUrl = 'https://github.com/veryfaraway/spark-utils.git'
        publicDownloadNumbers = true
        version {
            name = "${project.version}"
            desc = "Apache Spark Utils"
            released = new Date()
            vcsTag = "v${project.version}"
        }
    }
}

task sourcesJar(type: Jar) {
    from sourceSets.main.allSource
    archiveClassifier = 'sources'
}

task javadocJar(type: Jar) {
    from javadoc
    archiveClassifier = 'javadoc'
}

publishing {
    publications {
        MyPublication(MavenPublication) {
            from components.java
            artifact sourcesJar
            artifact javadocJar
            groupId "${project.group}"
            artifactId "${project.name}"
            version "${project.version}"
        }
    }
}